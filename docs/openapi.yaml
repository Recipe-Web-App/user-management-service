---
openapi: 3.0.0
info:
  title: User Management Service API
  description: |
    A comprehensive user management microservice providing authentication, profile management,
    social features and administrative capabilities for a recipe web application.

    ## Features
    - User registration and authentication (JWT-based)
    - Profile management with privacy controls
    - Social features (following/followers)
    - Administrative tools and metrics
    - Health monitoring endpoints

    ## Authentication

    This service uses **OAuth2 authentication** provided by an external OAuth2 service:

    - **Authorization Code Flow with PKCE** for web/mobile applications
    - **Client Credentials Flow** for service-to-service communication
    - **Scope-based authorization** with granular permissions
    - **Token introspection** and validation handled externally

    Include tokens in the Authorization header: `Authorization: Bearer <token>`

    **Note**: User registration, login, and password reset are handled by the external OAuth2 service, not by this API.

    ## Available OAuth2 Scopes
    - `openid` - Basic user identification (required)
    - `profile` - User profile information
    - `user:read` - Read user data and profiles
    - `user:write` - Create and update user data
    - `admin` - Administrative operations
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: http://localhost:8000/api/v1/user-management
    description: Development server
  - url: https://user-management.local/api/v1/user-management
    description: Production server

security:
  - HTTPBearer: []

tags:
  - name: users
    description: User profile and account operations
  - name: preferences
    description: User preference management (notification, display, privacy, etc.)
  - name: social
    description: Social features including following and activity
  - name: admin
    description: Administrative operations (requires admin role)
  - name: metrics
    description: System metrics and monitoring (requires admin role)
  - name: health
    description: Service health checks

paths:
  # User Management Endpoints
  /users/{userId}/profile:
    get:
      tags:
        - users
      summary: Get user profile
      description: Retrieve user profile information with privacy checks
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfileResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/profile:
    put:
      tags:
        - users
      summary: Update user profile
      description: Update current user's profile information
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserProfileUpdateRequest"
      responses:
        "200":
          description: Profile updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserProfileResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/account/delete-request:
    post:
      tags:
        - users
      summary: Request account deletion
      description: Request account deletion and receive a confirmation token
      responses:
        "200":
          description: Deletion request created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserAccountDeleteRequestResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/account:
    delete:
      tags:
        - users
      summary: Confirm account deletion
      description: Confirm account deletion using the confirmation token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserAccountDeleteRequest"
      responses:
        "200":
          description: Account successfully deactivated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserConfirmAccountDeleteResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/search:
    get:
      tags:
        - users
      summary: Search users
      description: Search for users by username or display name
      parameters:
        - name: query
          in: query
          description: Search query for username or display name
          schema:
            type: string
        - $ref: "#/components/parameters/LimitParam"
        - $ref: "#/components/parameters/OffsetParam"
        - $ref: "#/components/parameters/CountOnlyParam"
      responses:
        "200":
          description: User search results retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/{userId}:
    get:
      tags:
        - users
      summary: Get user by ID
      description: >-
        Retrieve public profile of another user. Respects privacy settings -
        private profiles may not be accessible to anonymous users or other users
        depending on their privacy preferences.
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      responses:
        "200":
          description: Public user profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserSearchResult"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  # User Preference Endpoints
  /users/{userId}/preferences:
    get:
      tags:
        - preferences
      summary: Get user preferences
      description: >-
        Retrieve all or filtered user preferences. Users can access their own
        preferences, admins can access any user's preferences, and services
        with user:read scope can also access preferences.
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - name: categories
          in: query
          description: >-
            Comma-separated list of preference categories to retrieve.
            If not specified, all categories are returned.
          schema:
            type: string
            example: "notification,display,privacy"
      responses:
        "200":
          description: User preferences retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferencesResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - preferences
      summary: Update multiple preference categories
      description: >-
        Update multiple preference categories at once. Only provided categories
        will be updated. Users can update their own preferences, admins can
        update any user's preferences, and services with user:write scope can
        also update preferences.
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserPreferencesUpdateRequest"
      responses:
        "200":
          description: User preferences updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserPreferencesResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  /users/{userId}/preferences/{category}:
    get:
      tags:
        - preferences
      summary: Get specific preference category
      description: Retrieve a specific preference category for a user.
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/PreferenceCategoryPath"
      responses:
        "200":
          description: Preference category retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PreferenceCategoryResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

    put:
      tags:
        - preferences
      summary: Update specific preference category
      description: >-
        Update a specific preference category. Supports partial updates -
        only provided fields will be updated.
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/PreferenceCategoryPath"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/NotificationPreferencesUpdate"
                - $ref: "#/components/schemas/DisplayPreferencesUpdate"
                - $ref: "#/components/schemas/PrivacyPreferencesUpdate"
                - $ref: "#/components/schemas/AccessibilityPreferencesUpdate"
                - $ref: "#/components/schemas/LanguagePreferencesUpdate"
                - $ref: "#/components/schemas/SecurityPreferencesUpdate"
                - $ref: "#/components/schemas/SocialPreferencesUpdate"
                - $ref: "#/components/schemas/SoundPreferencesUpdate"
                - $ref: "#/components/schemas/ThemePreferencesUpdate"
      responses:
        "200":
          description: Preference category updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PreferenceCategoryResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Social Features Endpoints
  /users/{userId}/following:
    get:
      tags:
        - social
      summary: Get following list
      description: Retrieve list of users the specified user is following
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/LimitParam"
        - $ref: "#/components/parameters/OffsetParam"
        - $ref: "#/components/parameters/CountOnlyParam"
      responses:
        "200":
          description: Following list retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetFollowedUsersResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/{userId}/followers:
    get:
      tags:
        - social
      summary: Get followers list
      description: Retrieve list of users following the current user
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/LimitParam"
        - $ref: "#/components/parameters/OffsetParam"
        - $ref: "#/components/parameters/CountOnlyParam"
      responses:
        "200":
          description: Followers list retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetFollowedUsersResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/{userId}/follow/{targetUserId}:
    post:
      tags:
        - social
      summary: Follow user
      description: Follow another user
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/TargetUserIdPath"
      responses:
        "200":
          description: Successfully followed user or already following
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FollowResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

    delete:
      tags:
        - social
      summary: Unfollow user
      description: Unfollow another user
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/TargetUserIdPath"
      responses:
        "200":
          description: Successfully unfollowed user or not following
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FollowResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/{userId}/following/{targetUserId}:
    get:
      tags:
        - social
      summary: Check if user follows another user
      description: Check if userId is following targetUserId
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - $ref: "#/components/parameters/TargetUserIdPath"
      responses:
        "200":
          description: Following status retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FollowingCheckResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "422":
          $ref: "#/components/responses/ValidationError"
        "500":
          $ref: "#/components/responses/InternalServerError"
        "503":
          $ref: "#/components/responses/ServiceUnavailable"

  /users/{userId}/activity:
    get:
      tags:
        - social
      summary: Get user activity
      description: Retrieve activity from a specific user (recipes, follows, reviews, favorites)
      parameters:
        - $ref: "#/components/parameters/UserIdPath"
        - name: perTypeLimit
          in: query
          description: Number of results to return per activity type
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 15
      responses:
        "200":
          description: User activity data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserActivityResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  # Admin Endpoints
  /admin/users/stats:
    get:
      tags:
        - admin
      summary: Get user statistics
      description: Return user statistics
      responses:
        "200":
          description: User stats returned
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserStatsResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "500":
          $ref: "#/components/responses/InternalServerError"

  # Metrics Endpoints
  /metrics/performance:
    get:
      tags:
        - metrics
      summary: Get performance metrics
      description: Get application performance metrics (requires admin authentication)
      responses:
        "200":
          description: Performance metrics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerformanceMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /metrics/cache:
    get:
      tags:
        - metrics
      summary: Get cache metrics
      description: Get cache performance metrics (requires admin authentication)
      responses:
        "200":
          description: Cache metrics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CacheMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /admin/cache/clear:
    post:
      tags:
        - admin
      summary: Clear cache entries
      description: Clear cache entries matching a pattern (requires admin authentication)
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                keyPattern:
                  type: string
                  default: "*"
                  description: Redis pattern for keys to clear
      responses:
        "200":
          description: Cache cleared successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CacheClearResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /metrics/system:
    get:
      tags:
        - metrics
      summary: Get system metrics
      description: Get system resource metrics (requires admin authentication)
      responses:
        "200":
          description: System metrics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SystemMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /metrics/health/detailed:
    get:
      tags:
        - metrics
      summary: Get detailed health metrics
      description: Get detailed health metrics for all services (requires admin authentication)
      responses:
        "200":
          description: Detailed health metrics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DetailedHealthMetrics"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  # Health Check Endpoints
  /health:
    get:
      tags:
        - health
      summary: Liveness check
      description: Returns a 200 OK response indicating the server is alive
      security: []
      responses:
        "200":
          description: Service is alive
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LivenessResponse"

  /ready:
    get:
      tags:
        - health
      summary: Readiness check
      description: |
        Returns a 200 OK response if the server is ready to serve requests.
        Returns degraded status (200) when database is down but Redis is healthy.
        Returns 503 only when Redis is unavailable since JWT sessions are critical.
      security: []
      responses:
        "200":
          description: Service is ready
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReadinessResponse"
        "503":
          description: Service unavailable (Redis is down)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ReadinessResponse"

components:
  securitySchemes:
    HTTPBearer:
      type: http
      scheme: bearer
      description: |
        Bearer token authentication using OAuth2 tokens.

        Include the token in the Authorization header: `Authorization: Bearer <token>`

        **Note**: Tokens are issued and validated by an external OAuth2 service.
        This service accepts valid Bearer tokens for authentication.

  parameters:
    UserIdPath:
      name: userId
      in: path
      required: true
      description: User ID
      schema:
        type: string
        format: uuid

    TargetUserIdPath:
      name: targetUserId
      in: path
      required: true
      description: Target user ID
      schema:
        type: string
        format: uuid

    LimitParam:
      name: limit
      in: query
      description: Number of results to return
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20

    OffsetParam:
      name: offset
      in: query
      description: Number of results to skip
      schema:
        type: integer
        minimum: 0
        default: 0

    CountOnlyParam:
      name: countOnly
      in: query
      description: Return only the count of results
      schema:
        type: boolean
        default: false

    PreferenceCategoryPath:
      name: category
      in: path
      required: true
      description: Preference category name
      schema:
        type: string
        enum:
          - notification
          - display
          - privacy
          - accessibility
          - language
          - security
          - social
          - sound
          - theme

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Unauthorized:
      description: Invalid or missing authorization token
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    Forbidden:
      description: Access forbidden
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    InsufficientScope:
      description: Insufficient OAuth2 Scope
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/OAuth2ScopeError"
          examples:
            missingWriteScope:
              summary: Missing write scope
              value:
                detail: "Missing required scope: user:write"
                errorCode: "INSUFFICIENT_SCOPE"
                requiredScopes: ["user:write"]
                availableScopes: ["user:read", "profile"]
            missingAdminScope:
              summary: Missing admin scope
              value:
                detail: "Missing required scope: admin"
                errorCode: "INSUFFICIENT_SCOPE"
                requiredScopes: ["admin"]
                availableScopes: ["user:read", "user:write", "profile"]

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

    ServiceUnavailable:
      description: Service temporarily unavailable
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # Error Response
    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          description: Error type or category
          example: validationError
        message:
          type: string
          description: Human-readable error message
          example: Invalid input data
        details:
          type: object
          description: Additional error details or context
          additionalProperties: true

    # User Management Schemas
    User:
      type: object
      required:
        - userId
        - username
        - isActive
        - createdAt
        - updatedAt
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
        username:
          type: string
          minLength: 1
          maxLength: 50
          description: Username for the user account
        email:
          type: string
          format: email
          nullable: true
          description: Email address for the user account
        fullName:
          type: string
          maxLength: 100
          nullable: true
          description: Full name of the user
        bio:
          type: string
          maxLength: 500
          nullable: true
          description: User's biography or description
        isActive:
          type: boolean
          description: Whether the user account is active
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the user account was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the user account was last updated

    UserSearchResult:
      type: object
      required:
        - userId
        - username
        - isActive
        - createdAt
        - updatedAt
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
        username:
          type: string
          description: Username for the user account
        fullName:
          type: string
          nullable: true
          description: Full name of the user
        isActive:
          type: boolean
          description: Whether the user account is active
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the user account was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the user account was last updated

    UserProfileResponse:
      type: object
      required:
        - userId
        - username
        - isActive
        - createdAt
        - updatedAt
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
        username:
          type: string
          description: Username for the user account
        email:
          type: string
          format: email
          nullable: true
          description: Email address (only included if contact info is visible to requester)
        fullName:
          type: string
          nullable: true
          description: Full name of the user
        bio:
          type: string
          nullable: true
          description: User's biography or description
        isActive:
          type: boolean
          description: Whether the user account is active
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the user account was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the user account was last updated

    UserProfileUpdateRequest:
      type: object
      properties:
        username:
          type: string
          nullable: true
          minLength: 3
          maxLength: 50
          pattern: "^[a-zA-Z0-9_]+$"
          description: Unique username (3-50 characters, alphanumeric and underscore only)
        email:
          type: string
          format: email
          nullable: true
          description: Valid email address
        fullName:
          type: string
          maxLength: 255
          nullable: true
          description: User's full name (max 255 characters)
        bio:
          type: string
          maxLength: 1000
          nullable: true
          description: User's bio/description (max 1000 characters)

    UserAccountDeleteRequest:
      type: object
      required:
        - confirmationToken
      properties:
        confirmationToken:
          type: string
          minLength: 1
          description: Confirmation token received from delete request

    UserAccountDeleteRequestResponse:
      type: object
      required:
        - userId
        - confirmationToken
        - expiresAt
      properties:
        userId:
          type: string
          format: uuid
          description: User ID
        confirmationToken:
          type: string
          description: Confirmation token for deletion
        expiresAt:
          type: string
          format: date-time
          description: Token expiration time

    UserConfirmAccountDeleteResponse:
      type: object
      required:
        - userId
        - deactivatedAt
      properties:
        userId:
          type: string
          format: uuid
          description: User ID
        deactivatedAt:
          type: string
          format: date-time
          description: Account deactivation time

    UserSearchResponse:
      type: object
      required:
        - results
        - totalCount
        - limit
        - offset
      properties:
        results:
          type: array
          items:
            $ref: "#/components/schemas/UserSearchResult"
          description: List of users matching the search query
        totalCount:
          type: integer
          description: Total number of users matching the search query
        limit:
          type: integer
          description: Number of results returned
        offset:
          type: integer
          description: Number of results skipped

    # Social Features Schemas
    GetFollowedUsersResponse:
      type: object
      required:
        - totalCount
      properties:
        totalCount:
          type: integer
          description: Total number of users being followed
        followedUsers:
          type: array
          items:
            $ref: "#/components/schemas/User"
          nullable: true
          description: List of users being followed (null when countOnly=true)
        limit:
          type: integer
          nullable: true
          description: Number of results returned (null when countOnly=true)
        offset:
          type: integer
          nullable: true
          description: Number of results skipped (null when countOnly=true)

    FollowResponse:
      type: object
      required:
        - message
        - isFollowing
      properties:
        message:
          type: string
          description: Success message for the follow/unfollow action
        isFollowing:
          type: boolean
          description: Whether the user is now following the target user

    FollowingCheckResponse:
      type: object
      required:
        - isFollowing
      properties:
        isFollowing:
          type: boolean
          description: Whether the user follows the target user
        followedAt:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the follow relationship was created (null if not following)

    UserActivityResponse:
      type: object
      required:
        - userId
        - recentRecipes
        - recentFollows
        - recentReviews
        - recentFavorites
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
        recentRecipes:
          type: array
          items:
            $ref: "#/components/schemas/RecipeSummary"
          description: List of recently created recipes
        recentFollows:
          type: array
          items:
            $ref: "#/components/schemas/UserSummary"
          description: List of recently followed users
        recentReviews:
          type: array
          items:
            $ref: "#/components/schemas/ReviewSummary"
          description: List of recent reviews written by the user
        recentFavorites:
          type: array
          items:
            $ref: "#/components/schemas/FavoriteSummary"
          description: List of recently favorited recipes

    RecipeSummary:
      type: object
      required:
        - recipeId
        - title
        - createdAt
      properties:
        recipeId:
          type: integer
          description: Unique identifier for the recipe
        title:
          type: string
          description: Title of the recipe
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the recipe was created

    UserSummary:
      type: object
      required:
        - userId
        - username
        - followedAt
      properties:
        userId:
          type: string
          format: uuid
          description: Unique identifier for the user
        username:
          type: string
          description: Username of the followed user
        followedAt:
          type: string
          format: date-time
          description: Timestamp when the user was followed

    ReviewSummary:
      type: object
      required:
        - reviewId
        - recipeId
        - rating
        - createdAt
      properties:
        reviewId:
          type: integer
          description: Unique identifier for the review
        recipeId:
          type: integer
          description: Unique identifier for the reviewed recipe
        rating:
          type: number
          description: Rating given in the review
        comment:
          type: string
          nullable: true
          description: Optional comment for the review
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the review was created

    FavoriteSummary:
      type: object
      required:
        - recipeId
        - title
        - favoritedAt
      properties:
        recipeId:
          type: integer
          description: Unique identifier for the favorited recipe
        title:
          type: string
          description: Title of the favorited recipe
        favoritedAt:
          type: string
          format: date-time
          description: Timestamp when the recipe was favorited

    # Admin Schemas
    UserStatsResponse:
      type: object
      properties:
        totalUsers:
          type: integer
        activeUsers:
          type: integer
        inactiveUsers:
          type: integer
        newUsersToday:
          type: integer
        newUsersThisWeek:
          type: integer
        newUsersThisMonth:
          type: integer

    # Metrics Schemas
    PerformanceMetrics:
      type: object
      properties:
        responseTimes:
          type: object
          properties:
            averageMs:
              type: number
            p50Ms:
              type: number
            p95Ms:
              type: number
            p99Ms:
              type: number
        requestCounts:
          type: object
          properties:
            totalRequests:
              type: integer
        errorRates:
          type: object
          properties:
            totalErrors:
              type: integer
            errorRatePercent:
              type: number
            4xxErrors:
              type: integer
            5xxErrors:
              type: integer
        database:
          type: object
          properties:
            activeConnections:
              type: integer
            maxConnections:
              type: integer

    CacheMetrics:
      type: object
      properties:
        memoryUsage:
          type: string
        memoryUsageHuman:
          type: string
        keysCount:
          type: integer
        hitRate:
          type: number
        connectedClients:
          type: integer
        evictedKeys:
          type: integer
        expiredKeys:
          type: integer

    CacheClearResponse:
      type: object
      properties:
        message:
          type: string
          example: Cache cleared successfully
        pattern:
          type: string
        clearedCount:
          type: integer

    SystemMetrics:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        system:
          type: object
          properties:
            cpuUsagePercent:
              type: number
            memoryTotalGb:
              type: number
            memoryUsedGb:
              type: number
            memoryUsagePercent:
              type: number
            diskTotalGb:
              type: number
            diskUsedGb:
              type: number
            diskUsagePercent:
              type: number
        process:
          type: object
          properties:
            memoryRssMb:
              type: number
            memoryVmsMb:
              type: number
            cpuPercent:
              type: number
            numThreads:
              type: integer
            openFiles:
              type: integer
        uptimeSeconds:
          type: integer

    DetailedHealthMetrics:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
        overallStatus:
          type: string
          enum: [healthy, degraded, unhealthy]
        services:
          type: object
          properties:
            redis:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, unhealthy]
                responseTimeMs:
                  type: number
                memoryUsage:
                  type: string
                connectedClients:
                  type: integer
                hitRatePercent:
                  type: number
            database:
              type: object
              properties:
                status:
                  type: string
                  enum: [healthy, unhealthy]
                responseTimeMs:
                  type: number
                activeConnections:
                  type: integer
                maxConnections:
                  type: integer
        application:
          type: object
          properties:
            version:
              type: string
            environment:
              type: string
            features:
              type: object
              properties:
                authentication:
                  type: string
                caching:
                  type: string
                monitoring:
                  type: string
                securityHeaders:
                  type: string

    # Health Check Schemas
    ReadinessResponse:
      type: object
      properties:
        status:
          type: string
          example: "READY"
        database:
          $ref: "#/components/schemas/DatabaseHealth"
        redis:
          $ref: "#/components/schemas/RedisHealth"

    DatabaseHealth:
      type: object
      properties:
        status:
          type: string
          example: "up"
        message:
          type: string
          example: "database is healthy"
        open_connections:
          type: string
          example: "1"
        in_use:
          type: string
          example: "0"
        idle:
          type: string
          example: "1"
        wait_count:
          type: string
          example: "0"
        wait_duration:
          type: string
          example: "0s"
        max_idle_closed:
          type: string
          example: "0"
        max_lifetime_closed:
          type: string
          example: "0"

    RedisHealth:
      type: object
      properties:
        status:
          type: string
          example: "up"
        message:
          type: string
          example: "redis is healthy"
        total_conns:
          type: string
          example: "3"
        idle_conns:
          type: string
          example: "3"
        stale_conns:
          type: string
          example: "0"
        hits:
          type: string
          example: "3"
        misses:
          type: string
          example: "0"
        timeouts:
          type: string
          example: "0"

    LivenessResponse:
      type: object
      properties:
        status:
          type: string
          example: "UP"

    HealthCheck:
      type: object
      properties:
        healthy:
          type: boolean
        message:
          type: string

    # OAuth2 Error Schemas
    OAuth2ScopeError:
      type: object
      required:
        - detail
        - errorCode
        - requiredScopes
      properties:
        detail:
          type: string
          description: Human-readable error message
          example: "Missing required scope: user:write"
        errorCode:
          type: string
          description: Machine-readable error code
          example: "INSUFFICIENT_SCOPE"
        requiredScopes:
          type: array
          items:
            type: string
          description: List of scopes required for this operation
          example: ["user:write"]
        availableScopes:
          type: array
          items:
            type: string
          description: List of scopes available in the current token
          example: ["user:read", "profile"]

    # Preference Enums
    FontSizeEnum:
      type: string
      enum:
        - SMALL
        - MEDIUM
        - LARGE
        - EXTRA_LARGE
      description: Font size preference

    ColorSchemeEnum:
      type: string
      enum:
        - LIGHT
        - DARK
        - AUTO
        - HIGH_CONTRAST
      description: Color scheme preference

    LayoutDensityEnum:
      type: string
      enum:
        - COMPACT
        - COMFORTABLE
        - SPACIOUS
      description: Layout density preference

    ProfileVisibilityEnum:
      type: string
      enum:
        - PUBLIC
        - FRIENDS_ONLY
        - PRIVATE
      description: Profile visibility setting

    LanguageEnum:
      type: string
      enum:
        - EN
        - ES
        - FR
        - DE
        - IT
        - PT
        - ZH
        - JA
        - KO
        - RU
      description: Language preference

    ThemeEnum:
      type: string
      enum:
        - LIGHT
        - DARK
        - AUTO
        - CUSTOM
      description: Theme preference

    # Preference Response Schemas
    UserPreferencesResponse:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          format: uuid
          description: User ID
        notification:
          $ref: "#/components/schemas/NotificationPreferences"
        display:
          $ref: "#/components/schemas/DisplayPreferences"
        privacy:
          $ref: "#/components/schemas/PrivacyPreferences"
        accessibility:
          $ref: "#/components/schemas/AccessibilityPreferences"
        language:
          $ref: "#/components/schemas/LanguagePreferences"
        security:
          $ref: "#/components/schemas/SecurityPreferences"
        social:
          $ref: "#/components/schemas/SocialPreferences"
        sound:
          $ref: "#/components/schemas/SoundPreferences"
        theme:
          $ref: "#/components/schemas/ThemePreferences"

    PreferenceCategoryResponse:
      type: object
      required:
        - userId
        - category
        - preferences
        - updatedAt
      properties:
        userId:
          type: string
          format: uuid
          description: User ID
        category:
          type: string
          description: Preference category name
        preferences:
          type: object
          description: Category-specific preferences object
        updatedAt:
          type: string
          format: date-time
          description: Last update timestamp

    # Category-specific preference schemas
    NotificationPreferences:
      type: object
      properties:
        emailNotifications:
          type: boolean
          description: Enable email notifications
        pushNotifications:
          type: boolean
          description: Enable push notifications
        smsNotifications:
          type: boolean
          description: Enable SMS notifications
        marketingEmails:
          type: boolean
          description: Enable marketing emails
        securityAlerts:
          type: boolean
          description: Enable security alerts
        activitySummaries:
          type: boolean
          description: Enable activity summaries
        recipeRecommendations:
          type: boolean
          description: Enable recipe recommendations
        socialInteractions:
          type: boolean
          description: Enable social interaction notifications
        updatedAt:
          type: string
          format: date-time

    DisplayPreferences:
      type: object
      properties:
        fontSize:
          $ref: "#/components/schemas/FontSizeEnum"
        colorScheme:
          $ref: "#/components/schemas/ColorSchemeEnum"
        layoutDensity:
          $ref: "#/components/schemas/LayoutDensityEnum"
        showImages:
          type: boolean
          description: Show images in listings
        compactMode:
          type: boolean
          description: Enable compact display mode
        updatedAt:
          type: string
          format: date-time

    PrivacyPreferences:
      type: object
      properties:
        profileVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        recipeVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        activityVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        contactInfoVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        dataSharing:
          type: boolean
          description: Allow data sharing with partners
        analyticsTracking:
          type: boolean
          description: Allow analytics tracking
        updatedAt:
          type: string
          format: date-time

    AccessibilityPreferences:
      type: object
      properties:
        screenReader:
          type: boolean
          description: Optimize for screen readers
        highContrast:
          type: boolean
          description: Enable high contrast mode
        reducedMotion:
          type: boolean
          description: Reduce motion and animations
        largeText:
          type: boolean
          description: Use larger text
        keyboardNavigation:
          type: boolean
          description: Enable keyboard navigation
        updatedAt:
          type: string
          format: date-time

    LanguagePreferences:
      type: object
      properties:
        primaryLanguage:
          $ref: "#/components/schemas/LanguageEnum"
        secondaryLanguage:
          $ref: "#/components/schemas/LanguageEnum"
        translationEnabled:
          type: boolean
          description: Enable automatic translation
        updatedAt:
          type: string
          format: date-time

    SecurityPreferences:
      type: object
      properties:
        twoFactorAuth:
          type: boolean
          description: Enable two-factor authentication
        loginNotifications:
          type: boolean
          description: Notify on new logins
        sessionTimeout:
          type: boolean
          description: Enable session timeout
        passwordRequirements:
          type: boolean
          description: Enable strict password requirements
        updatedAt:
          type: string
          format: date-time

    SocialPreferences:
      type: object
      properties:
        friendRequests:
          type: boolean
          description: Allow friend requests
        messageNotifications:
          type: boolean
          description: Enable message notifications
        groupInvites:
          type: boolean
          description: Allow group invites
        shareActivity:
          type: boolean
          description: Share activity with followers
        updatedAt:
          type: string
          format: date-time

    SoundPreferences:
      type: object
      properties:
        notificationSounds:
          type: boolean
          description: Enable notification sounds
        systemSounds:
          type: boolean
          description: Enable system sounds
        volumeLevel:
          type: boolean
          description: Enable volume control
        muteNotifications:
          type: boolean
          description: Mute all notifications
        updatedAt:
          type: string
          format: date-time

    ThemePreferences:
      type: object
      properties:
        darkMode:
          type: boolean
          description: Enable dark mode
        lightMode:
          type: boolean
          description: Enable light mode
        autoTheme:
          type: boolean
          description: Auto-switch based on system
        customTheme:
          $ref: "#/components/schemas/ThemeEnum"
        updatedAt:
          type: string
          format: date-time

    # Preference Update Request Schemas
    UserPreferencesUpdateRequest:
      type: object
      description: Update multiple preference categories at once
      properties:
        notification:
          $ref: "#/components/schemas/NotificationPreferencesUpdate"
        display:
          $ref: "#/components/schemas/DisplayPreferencesUpdate"
        privacy:
          $ref: "#/components/schemas/PrivacyPreferencesUpdate"
        accessibility:
          $ref: "#/components/schemas/AccessibilityPreferencesUpdate"
        language:
          $ref: "#/components/schemas/LanguagePreferencesUpdate"
        security:
          $ref: "#/components/schemas/SecurityPreferencesUpdate"
        social:
          $ref: "#/components/schemas/SocialPreferencesUpdate"
        sound:
          $ref: "#/components/schemas/SoundPreferencesUpdate"
        theme:
          $ref: "#/components/schemas/ThemePreferencesUpdate"

    NotificationPreferencesUpdate:
      type: object
      description: Partial update for notification preferences
      properties:
        emailNotifications:
          type: boolean
        pushNotifications:
          type: boolean
        smsNotifications:
          type: boolean
        marketingEmails:
          type: boolean
        securityAlerts:
          type: boolean
        activitySummaries:
          type: boolean
        recipeRecommendations:
          type: boolean
        socialInteractions:
          type: boolean

    DisplayPreferencesUpdate:
      type: object
      description: Partial update for display preferences
      properties:
        fontSize:
          $ref: "#/components/schemas/FontSizeEnum"
        colorScheme:
          $ref: "#/components/schemas/ColorSchemeEnum"
        layoutDensity:
          $ref: "#/components/schemas/LayoutDensityEnum"
        showImages:
          type: boolean
        compactMode:
          type: boolean

    PrivacyPreferencesUpdate:
      type: object
      description: Partial update for privacy preferences
      properties:
        profileVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        recipeVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        activityVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        contactInfoVisibility:
          $ref: "#/components/schemas/ProfileVisibilityEnum"
        dataSharing:
          type: boolean
        analyticsTracking:
          type: boolean

    AccessibilityPreferencesUpdate:
      type: object
      description: Partial update for accessibility preferences
      properties:
        screenReader:
          type: boolean
        highContrast:
          type: boolean
        reducedMotion:
          type: boolean
        largeText:
          type: boolean
        keyboardNavigation:
          type: boolean

    LanguagePreferencesUpdate:
      type: object
      description: Partial update for language preferences
      properties:
        primaryLanguage:
          $ref: "#/components/schemas/LanguageEnum"
        secondaryLanguage:
          $ref: "#/components/schemas/LanguageEnum"
        translationEnabled:
          type: boolean

    SecurityPreferencesUpdate:
      type: object
      description: Partial update for security preferences
      properties:
        twoFactorAuth:
          type: boolean
        loginNotifications:
          type: boolean
        sessionTimeout:
          type: boolean
        passwordRequirements:
          type: boolean

    SocialPreferencesUpdate:
      type: object
      description: Partial update for social preferences
      properties:
        friendRequests:
          type: boolean
        messageNotifications:
          type: boolean
        groupInvites:
          type: boolean
        shareActivity:
          type: boolean

    SoundPreferencesUpdate:
      type: object
      description: Partial update for sound preferences
      properties:
        notificationSounds:
          type: boolean
        systemSounds:
          type: boolean
        volumeLevel:
          type: boolean
        muteNotifications:
          type: boolean

    ThemePreferencesUpdate:
      type: object
      description: Partial update for theme preferences
      properties:
        darkMode:
          type: boolean
        lightMode:
          type: boolean
        autoTheme:
          type: boolean
        customTheme:
          $ref: "#/components/schemas/ThemeEnum"
